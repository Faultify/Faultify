<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Test Runner - Faultify</title>
        
        


        <!-- Custom HTML head -->
        


        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        
        <link rel="icon" href="favicon.svg">
        
        
        <link rel="shortcut icon" href="favicon.png">
        
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        
        <link rel="stylesheet" href="css/print.css" media="print">
        

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        
        <link rel="stylesheet" href="fonts/fonts.css">
        

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        

        
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="getting-started.html"><strong aria-hidden="true">1.</strong> Getting Started</a></li><li class="chapter-item expanded "><a href="mutation.html"><strong aria-hidden="true">2.</strong> Mutations</a></li><li class="chapter-item expanded "><a href="analyzers/theory.html"><strong aria-hidden="true">3.</strong> Analyzers</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="analyzers/theory.html"><strong aria-hidden="true">3.1.</strong> Analyzers Theory</a></li><li class="chapter-item expanded "><a href="analyzers/usage.html"><strong aria-hidden="true">3.2.</strong> Custom Analyzer</a></li></ol></li><li class="chapter-item expanded "><a href="test-runner.html" class="active"><strong aria-hidden="true">4.</strong> Test Runner</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                        
                    </div>

                    <h1 class="menu-title">Faultify</h1>

                    <div class="right-buttons">
                        
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        
                        
                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" name="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h2><a class="header" href="#test-process-overview" id="test-process-overview">Test Process Overview</a></h2>
<p><strong>The main test process overview looks like this:</strong></p>
<img src="./img/test-process-overview.PNG" alt="drawing" width="500"/>
<p><strong>The test process from Faultily looks like this:</strong></p>
<img src="./img/test-process.PNG" alt="drawing" width="500"/>
<ol>
<li><strong>Build:</strong> This is the initial project build to determine if the project compiles and make sure all assemblies are on their place. </li>
<li><strong>Inject Coverage:</strong> Here the test coverage functions are injected. </li>
<li><strong>Coverage Test Session:</strong> This initial test session determines: 1) Which tests cover what mutations 2) Test duration used for the real test runs.</li>
<li><strong>Rebuild:</strong> Rebuilds the project to remove all injected test code.</li>
<li><strong>Generate Test Session:</strong> Generate the test runs and binpack the testruns to run multiple mutations at once.</li>
<li><strong>Run Test Sessions:</strong> Run the test sessions in serial (un the future this will be parallel).</li>
<li><strong>Generate Report:</strong> Generate a report from all test results.</li>
</ol>
<h2><a class="header" href="#optimisation" id="optimisation">Optimisation</a></h2>
<p>Dotnet test is used for executing tests.
Dotnet test has a process startup/shutdown overhead time of about 1 second. 
For example, take 2000 mutations, this will take 2000 seconds (33 minutes) for the process management only. 
Therefore optimizations are essential for a well-functioning mutation tool.</p>
<p>Faultily Has Implemented:</p>
<ul>
<li>Mutation Bin Packing</li>
<li>Mutation Levels</li>
<li>Run Mutations in Parallel</li>
</ul>
<p>Faultily Will Support:</p>
<ul>
<li>Memory Mapped Files</li>
</ul>
<p><strong>Run Tests from Memory</strong></p>
<p>‘dotnet test’ is a wrapper over ‘vs-test-console’ which are both external processes. 
In an ideal scenario, you would want to be able to load unit tests into memory and then run them from code. 
This can save about 1 second per test run. As far I was able to find out vsconsole can only be used as an external process (<code>VsConsoleWrapper</code>).
However, it might be possible for Nunit to be run directly from code. 
Though that will limit the support for other test frameworks. </p>
<p><strong>Memory Mapped Files and or Ramdisk</strong></p>
<p>Memory-mapped files (a really amazing undervalued technique) and/or a ramdisk makes use of RAM memory allowing for very fast file reading/writing. 
The ramdisk can be used to run the entire test process and the memory-mapped files can be used for the assemblies under mutation.</p>
<p><strong>Mutation Bin Packing</strong></p>
<p>A mutation can cause a test to fail or to succeed, so it is impossible to mutate two mutations that are covered by a test at the same time. 
If you did, there is no way to tell which mutation caused the test to fail. This scenario is a perfect bin-packing problem. 
The test is the bin and the mutation is the packet. Each test can have only one mutation at a time and you can run one test within a test session. 
Following that algorithm, multiple mutations can be performed at the same time.
In order to implement this algorithm, one has to measure code coverage.</p>
<p><strong>Run Mutations in Parallel</strong></p>
<p>An assembly is mutated and the tests have a reference to this assembly. 
It is not possible to run multiple test sessions because they would mutate the same assembly. 
In addition, the CLR locks the assemblies of a test process. 
To use multiple processes, the tests and assemblies under test should be duplicated so that each test process has its own assembly files. 
Thus, this implies that the number of threads is equal to the number of duplications of the binaries.</p>
<p><strong>Mutation Level</strong></p>
<p>With some types of mutations, it may be possible that the mutation results in the same value such as ‘1 + 1’ to ‘1*1’, 
therefore for these mutations all variants ‘+, -, *, /’ should be performed for the best result.
Though for large projects testing all variants is time consuming and maybe not worth it. 
Therefore the test session could use mutation levels like: Detailed, Medium, Simple to indicate which depth to use for testintg.</p>
<h2><a class="header" href="#coverage" id="coverage">Coverage</a></h2>
<p>Faultify measures code coverage by injecting a static register function in both the unit test and all methods from the assembly under test. 
When the code coverage test run is performed those static functions are called. First, the unit test that runs registers its name after that all methods called by this unit test will register their ‘Entity Handle’. After this run, we can exactly see what unit tests covered which methods. 
Difficulties are:</p>
<ul>
<li>Since unit tests can cover code behind interfaces it's impossible to use reflection to test code coverage.</li>
<li>To know whether a mutation is covered we need to somehow identify this mutation. We had complications doing so, instead, we register only the method entity handle. 
This entails that test coverage is method based not mutation-based which implies that more mutations will be performed.</li>
</ul>
<p><img src="./img/coverage.PNG" alt="Analyzers" /></p>
<p>When running the test process the code will do something like the following:</p>
<ol>
<li>Run Unit Test</li>
<li>Register name from unit test</li>
<li>Run method that is tested by unit test.</li>
<li>Register method name.</li>
</ol>
<p>Those results are written to: <code>coverage.bin</code>.
At the end of the test process this data is used by faultify to binpack the tests with mutations (see above).</p>
<h2><a class="header" href="#datacollector" id="datacollector">DataCollector</a></h2>
<p>The test data collectors are used to handle events from the test host.
With those events Faultify can do useful things. </p>
<ul>
<li><code>TestDataCollector</code>: Collects the test status from running tests and writes them to <code>test_results.bin</code>.</li>
<li><code>CoverageDataCollector</code>: Filters the <code>coverage.bin</code> such that only the tests it saw will remain in the file.</li>
</ul>
<p>The reason why a custom byte format is used instead of json is that within a DataCollector it was not possible to use 
a Json library.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        
                            <a rel="prev" href="analyzers/usage.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                        

                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                
                    <a rel="prev" href="analyzers/usage.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                

                
            </nav>

        </div>

        

        

        

        
        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        

        

        
        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        

        

    </body>
</html>
